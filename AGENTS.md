# Repository Guidelines

## Project Structure & Module Organization
- `src/Malgo/...`: Haskell source (modules `Malgo.*`). Example: `src/Malgo/Parser.hs` → `module Malgo.Parser`.
- `app/malgo/Main.hs`: CLI entry (`malgo eval ...`).
- `runtime/`: Malgo runtime/stdlib; `examples/`: sample `.mlg` programs.
- `test/`: Hspec tests and golden cases (`test/Malgo/*Spec.hs`, `test/testcases/`).
- `docs/`, `nix/`: documentation and Nix files.

## Build, Test, and Development Commands
- `mise run setup`: Install toolchain (GHC, cabal, hpack, ormolu) and update indices.
- `mise run build`: Format then build (`hpack && cabal build`).
- `mise run test`: Run test suite; filter with `--match=Parser`.
- `mise run exec`: Run the executable (`cabal exec malgo-exe`).
- Install CLI: `cabal install` then use `malgo eval examples/malgo/Hello.mlg`.

## Coding Style & Naming Conventions
- Formatter: Ormolu. Run `mise run format` before commits.
- Lint: HLint rules in `.hlint.yaml` (e.g., alias `Data.Text` as `T`, `Data.ByteString` as `BS`, lazy variants `TL`/`BL`). Avoid `Debug.Trace`.
- Modules: `Malgo.Foo.Bar` maps to `src/Malgo/Foo/Bar.hs`; tests mirror structure under `test/Malgo`.
- Prefer explicit imports; keep top-level exports intentional.

## Testing Guidelines
- Framework: Hspec with discovery (`test/Spec.hs`). Each spec exposes `spec :: Spec` and ends with `*Spec.hs`.
- Golden tests: Outputs written under `.golden`. To reset: `mise run reset`.
- Run with details: `cabal test --test-show-details=direct` or `mise run test`.

## Commit & Pull Request Guidelines
- Conventional Commits (see `.gitmessage`). Example: `feat(parser): support C-style apply`.
- PRs: describe changes, link issues, include tests for behavior changes, update docs/examples if CLI or syntax changes.
- Quality gate: run `mise run format && mise run test` locally; ensure CI passes.

## Tips & Environment
- HLS: `mise run setup-hls` for editor integration.
- Package metadata is generated by `hpack` from `package.yaml`; don’t edit `.cabal` directly.
- Nix: `flake.nix` provides reproducible envs; optional for contributors using Nix.
