[tools]
go = "latest"
watchexec = "latest"
ghcup = "latest"
[env]
_.path = [
    "~/.ghcup/bin",
    "~/.local/bin",
    "~/.cabal/bin"
]
[tasks.setup]
description = "Setup tools"
run = [
    "ghcup install ghc 9.12.2",
    "ghcup set ghc 9.12.2",
    "ghcup install cabal latest",
    "ghcup set cabal latest",
    "go install github.com/git-chglog/git-chglog/cmd/git-chglog@latest",
    "cabal install hpack --ignore-project --overwrite-policy=always",
]
[tasks.setup-hls]
description = "Setup HLS"
run = "ghcup compile hls -g 2.11.0.0 --ghc 9.12.2 --cabal-update"
[tasks.build]
description = "Build the project"
run = "hpack && cabal build"
[tasks.test]
description = "Run the tests"
depends = ["build"]
run = """
    if [ 'false' = '{{option(name="match")}}' ]; then
        cabal test --test-show-details=direct
    else
        cabal test --test-show-details=direct --test-options=--match --test-options={{option(name="match")}}
    fi
"""
[tasks.exec]
description = "Run the project"
depends = ["build"]
run = "cabal exec malgo-exe"
[tasks.changelog]
description = "Generate changelog"
run = "git-chglog -o CHANGELOG.md"